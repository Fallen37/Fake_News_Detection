<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake News Detector</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 25px;
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .main-content {
            display: flex;
            min-height: 600px;
        }

        .left-panel {
            flex: 1;
            padding: 30px;
            border-right: 2px solid #e0e0e0;
        }

        .right-panel {
            flex: 1;
            padding: 30px;
            background-color: #fafafa;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-label {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-top: 15px;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .analyze-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: left;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin-top: 15px;
        }

        .loading-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: #667eea;
            font-weight: 600;
            font-size: 16px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        .progress-steps {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .progress-step {
            padding: 8px 0;
            color: #666;
            font-size: 14px;
            display: flex;
            align-items: center;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .progress-step.active {
            color: #667eea;
            font-weight: 600;
            opacity: 1;
        }

        .progress-step.completed {
            color: #28a745;
            opacity: 1;
        }

        .step-icon {
            width: 16px;
            height: 16px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .step-details {
            margin-left: 26px;
            font-size: 12px;
            color: #888;
            font-style: italic;
            margin-top: 2px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-result {
            display: none;
            margin-top: 20px;
        }

        .verdict {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .verdict.true {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .verdict.false {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .analysis-text {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin-bottom: 20px;
        }

        .sources-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .source-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .source-timestamp {
            font-size: 12px;
            color: #666;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .source-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .source-content {
            font-size: 14px;
            color: #555;
            line-height: 1.5;
        }

        .source-link {
            color: #667eea;
            text-decoration: none;
            font-size: 12px;
            margin-top: 8px;
            display: inline-block;
        }

        .source-link:hover {
            text-decoration: underline;
        }

        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin-top: 15px;
        }

        .explanation-summary {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stats-bar {
            display: flex;
            justify-content: space-between;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-weight: bold;
            color: #667eea;
            font-size: 18px;
        }

        .stat-label {
            color: #666;
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .left-panel {
                border-right: none;
                border-bottom: 2px solid #e0e0e0;
            }
            
            .container {
                margin: 10px;
            }
            
            body {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            Fake News Detector
        </div>
        
        <div class="main-content">
            <div class="left-panel">
                <div class="input-section">
                    <div class="input-label">User Input:</div>
                    <input type="text" 
                           class="input-field" 
                           id="userInput" 
                           placeholder="Enter keywords about the news event (e.g., 'Swiss resort fire', 'La Constellation fire')"
                           maxlength="200">
                    <div style="margin-top: 10px;">
                        <button class="analyze-btn" id="analyzeBtn" onclick="analyzeNews()">
                            Analyze News
                        </button>
                        <button class="analyze-btn" onclick="setExampleQuery('Swiss resort fire')" 
                                style="background: #6c757d; margin-left: 10px;">
                            Try Example
                        </button>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <div class="loading-header">
                        <div class="spinner"></div>
                        Analyzing News Event...
                    </div>
                    <ul class="progress-steps" id="progressSteps">
                        <li class="progress-step" id="step1">
                            <span class="step-icon">üîç</span>
                            <span>Analyzing user input and extracting keywords</span>
                            <div class="step-details" id="step1Details"></div>
                        </li>
                        <li class="progress-step" id="step2">
                            <span class="step-icon">üåê</span>
                            <span>Searching for relevant news articles</span>
                            <div class="step-details" id="step2Details"></div>
                        </li>
                        <li class="progress-step" id="step3">
                            <span class="step-icon">üì∞</span>
                            <span>Collecting articles from multiple sources</span>
                            <div class="step-details" id="step3Details"></div>
                        </li>
                        <li class="progress-step" id="step4">
                            <span class="step-icon">‚è∞</span>
                            <span>Analyzing temporal patterns and evolution</span>
                            <div class="step-details" id="step4Details"></div>
                        </li>
                        <li class="progress-step" id="step5">
                            <span class="step-icon">ü§ñ</span>
                            <span>Running RNN analysis for authenticity detection</span>
                            <div class="step-details" id="step5Details"></div>
                        </li>
                        <li class="progress-step" id="step6">
                            <span class="step-icon">‚úÖ</span>
                            <span>Generating verdict and explanation</span>
                            <div class="step-details" id="step6Details"></div>
                        </li>
                    </ul>
                </div>

                <div class="analysis-result" id="analysisResult">
                    <div class="verdict" id="verdict"></div>
                    
                    <div class="stats-bar" id="statsBar" style="display: none;">
                        <div class="stat-item">
                            <div class="stat-value" id="credibilityScore">-</div>
                            <div class="stat-label">Credibility Score</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="articlesCount">-</div>
                            <div class="stat-label">Sources Analyzed</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="timelineSpan">-</div>
                            <div class="stat-label">Timeline (hours)</div>
                        </div>
                    </div>
                    
                    <div class="analysis-text" id="analysisText"></div>
                    
                    <div class="explanation-summary" id="explanationSummary"></div>
                </div>

                <div class="error-message" id="errorMessage" style="display: none;"></div>
            </div>
            
            <div class="right-panel">
                <div class="sources-header">Sources Timeline</div>
                <div id="sourcesTimeline">
                    <div style="text-align: center; color: #666; padding: 40px; font-style: italic;">
                        Enter keywords and click "Analyze News" to see source timeline
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Disclaimer -->
        <div style="background: #f8f9fa; padding: 15px; margin-top: 20px; border-radius: 8px; border-left: 4px solid #ffc107; font-size: 14px; color: #856404;">
            <strong>‚ö†Ô∏è Disclaimer:</strong> This system is AI-driven and may make mistakes. Results should be used as guidance only. 
            Always verify important news through multiple credible sources and use your own judgment. 
            The system analyzes patterns and source credibility but cannot guarantee 100% accuracy.
        </div>
    </div>

    <script>
        // Allow Enter key to trigger analysis
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeNews();
            }
        });

        async function analyzeNews() {
            const userInput = document.getElementById('userInput').value.trim();
            const analyzeBtn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const analysisResult = document.getElementById('analysisResult');
            const errorMessage = document.getElementById('errorMessage');
            
            // Reset UI
            analysisResult.style.display = 'none';
            errorMessage.style.display = 'none';
            resetProgressSteps();
            
            if (!userInput) {
                showError('Please enter some keywords about the news event you want to verify.');
                return;
            }

            // Show loading state
            analyzeBtn.disabled = true;
            loading.style.display = 'block';

            // Start progress simulation
            simulateProgress(userInput);

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: userInput
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Analysis failed');
                }

                // Complete all steps
                completeAllSteps();
                
                // Small delay to show completion
                setTimeout(() => {
                    displayResults(data);
                }, 500);

            } catch (error) {
                console.error('Error:', error);
                showError(error.message || 'An error occurred during analysis. Please try again.');
            } finally {
                // Hide loading state
                setTimeout(() => {
                    loading.style.display = 'none';
                    analyzeBtn.disabled = false;
                }, 1000);
            }
        }

        function resetProgressSteps() {
            const steps = document.querySelectorAll('.progress-step');
            steps.forEach(step => {
                step.classList.remove('active', 'completed');
            });
            
            // Clear all step details
            for (let i = 1; i <= 6; i++) {
                document.getElementById(`step${i}Details`).textContent = '';
            }
        }

        function simulateProgress(userInput) {
            // Step 1: Keyword extraction
            setTimeout(() => {
                activateStep(1);
                const keywords = extractKeywordsForDisplay(userInput);
                document.getElementById('step1Details').textContent = `Keywords identified: ${keywords.join(', ')}`;
            }, 200);

            // Step 2: Search initiation
            setTimeout(() => {
                completeStep(1);
                activateStep(2);
                document.getElementById('step2Details').textContent = `Searching news databases for: "${userInput}"`;
            }, 800);

            // Step 3: Article collection
            setTimeout(() => {
                completeStep(2);
                activateStep(3);
                document.getElementById('step3Details').textContent = 'Found articles from Reuters, BBC, Associated Press...';
            }, 1500);

            // Step 4: Temporal analysis
            setTimeout(() => {
                completeStep(3);
                activateStep(4);
                document.getElementById('step4Details').textContent = 'Analyzing sentiment, certainty, and vocabulary evolution...';
            }, 2200);

            // Step 5: RNN processing
            setTimeout(() => {
                completeStep(4);
                activateStep(5);
                document.getElementById('step5Details').textContent = 'LSTM processing temporal sequences with attention mechanism...';
            }, 2800);

            // Step 6: Final verdict
            setTimeout(() => {
                completeStep(5);
                activateStep(6);
                document.getElementById('step6Details').textContent = 'Calculating credibility score and generating explanation...';
            }, 3400);
        }

        function extractKeywordsForDisplay(text) {
            // Simple keyword extraction for display
            const stopWords = ['the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 'is', 'was', 'are', 'were'];
            const words = text.toLowerCase().match(/\b\w+\b/g) || [];
            const keywords = words.filter(word => !stopWords.includes(word) && word.length > 2);
            return keywords.slice(0, 5); // Show first 5 keywords
        }

        function activateStep(stepNumber) {
            const step = document.getElementById(`step${stepNumber}`);
            step.classList.add('active');
            step.classList.remove('completed');
        }

        function completeStep(stepNumber) {
            const step = document.getElementById(`step${stepNumber}`);
            step.classList.remove('active');
            step.classList.add('completed');
            
            // Change icon to checkmark
            const icon = step.querySelector('.step-icon');
            icon.textContent = '‚úÖ';
        }

        function completeAllSteps() {
            for (let i = 1; i <= 6; i++) {
                completeStep(i);
            }
            document.getElementById('step6Details').textContent = 'Analysis complete! Generating results...';
        }

        function displayResults(data) {
            const analysisResult = document.getElementById('analysisResult');
            const verdict = document.getElementById('verdict');
            const analysisText = document.getElementById('analysisText');
            const explanationSummary = document.getElementById('explanationSummary');
            const sourcesTimeline = document.getElementById('sourcesTimeline');
            const statsBar = document.getElementById('statsBar');
            
            // Set verdict
            verdict.textContent = `This news is ${data.verdict}.`;
            verdict.className = `verdict ${data.is_true ? 'true' : 'false'}`;
            
            // Set analysis text
            analysisText.innerHTML = data.main_analysis;
            
            // Add processing details if available
            if (data.processing_details) {
                const processingInfo = document.createElement('div');
                processingInfo.style.cssText = 'background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #28a745;';
                processingInfo.innerHTML = `
                    <h4 style="margin: 0 0 10px 0; color: #28a745;">üîç Analysis Process Completed:</h4>
                    <ul style="margin: 0; padding-left: 20px;">
                        ${data.processing_details.analysis_steps.map(step => `<li style="margin: 5px 0; font-size: 14px;">${step}</li>`).join('')}
                    </ul>
                `;
                analysisText.appendChild(processingInfo);
            }
            
            // Set explanation summary
            explanationSummary.innerHTML = data.explanation_summary;
            
            // Update stats
            document.getElementById('credibilityScore').textContent = data.credibility_score.toFixed(2);
            document.getElementById('articlesCount').textContent = data.articles_count;
            document.getElementById('timelineSpan').textContent = data.timeline_span_hours.toFixed(1);
            statsBar.style.display = 'flex';
            
            // Display sources timeline
            displaySourcesTimeline(data.sources_timeline);
            
            // Show results
            analysisResult.style.display = 'block';
        }

        function displaySourcesTimeline(sources) {
            const sourcesTimeline = document.getElementById('sourcesTimeline');
            
            if (!sources || sources.length === 0) {
                sourcesTimeline.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No sources found</div>';
                return;
            }

            let html = '';
            sources.forEach(source => {
                html += `
                    <div class="source-item">
                        <div class="source-timestamp">${source.timestamp}: ${source.source}</div>
                        <div class="source-title">${source.title}</div>
                        <div class="source-content">${source.content_preview}</div>
                        <a href="${source.url}" class="source-link" target="_blank">Read full article ‚Üí</a>
                    </div>
                `;
            });
            
            sourcesTimeline.innerHTML = html;
        }

        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        // Example queries for demonstration
        function setExampleQuery(query) {
            document.getElementById('userInput').value = query;
        }

        // Add some example buttons (optional)
        document.addEventListener('DOMContentLoaded', function() {
            // You can add example buttons here if needed
        });
    </script>
</body>
</html>